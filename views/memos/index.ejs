<%- include('../partials/header') %>

<div class="container">
    <div class="row">
    <div class="offset-md-3 col-md-6 ps-0 pe-0">

        <h2>MEMOS</h2>

        <% memos.forEach(function(m) { %>
        <div class="memo">
            <p class="memo-details"><%= m.formattedDate %></p>
            <p class="memo-details"><%= m.location %></p>
            <p class="memo-details bold-name"><%= m.networkName %></p>
            <p class="memo-details"><%= m.note %></p>
            <% if (m.image && m.image !== 'defaultImageURLHere') { %>
                <img src="<%= m.image %>" alt="uploaded image" onclick="showImageModal(this.src);" loading="lazy">
            <% } %>
            
            <section class="memo-cta">
                    <form action="/memos/<%= m._id %>/edit" method="GET">
                        <button type="submit" class=" btn memo-icon"><img src="/images/icon-edit.png" alt="edit"></button>
                    </form>
                <% if (user && user._id.equals(m.user)) { %>
                    <form action="/memos/<%= m._id %>?_method=DELETE" method="POST" onsubmit="return confirmDelete()">
                        <button class="btn memo-icon" type="submit"><img src="/images/icon-close.png" alt="delete"></button>
                    </form>
                <% } %>
            </section>

            <hr class="memo-divider">
        </div>
        <% }); %>

    <script>
    function confirmDelete() {
        return confirm('Are you sure you want to delete?');
    }
    </script>

        <% if (totalPages > 1) { %>
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <% for(let i = 1; i <= totalPages; i++) { %>
                    <li class="page-item <%= i === page ? 'active' : '' %>">
                        <a class="page-link" href="/memos?page=<%= i %>"><%= i %></a>
                    </li>
                    <% } %>
                </ul>
            </nav>
        <% } %>

    </div>
    </div>
</div>

<!-- Bootstrap image modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel">Image View</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <img src="" id="modalImage" class="img-fluid" alt="Responsive image">
            </div>
        </div>
    </div>
</div>

<script>
    function showImageModal(src) {
      document.getElementById('modalImage').src = src;
      
      var imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
      imageModal.show();
    }
</script>

<%- include('../partials/footer') %>
